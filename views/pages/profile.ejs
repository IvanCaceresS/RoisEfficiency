<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>Editar perfil usuario</title>
        <link rel="icon" href="images/LOGO-1.png"/>
        <!-- Bootstrap icons-->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="css/styles.css" rel="stylesheet" />
        <link href="css/perfil.css" rel="stylesheet" />
        <link href="css/login.css" rel="stylesheet" />
        <link href="css/header.css" rel="stylesheet" />
    </head>
    <body>

        <!-- Navigation-->
         <!-- Nueva fila superior con color de fondo -->
    <div class="container-fluid">
      <div class="row barra-principal" style="background-color: #750d37; color: white; padding: 2px; z-index: 10;">
          <div class="col text-center" style="max-width: 100%;">
              Rois Chile <i class="fas fa-glasses"></i> | Envíos a todo Chile <i class="fas fa-shipping-fast"></i> | Entregas en la V región <i class="fas fa-truck"></i> 
          </div>
      </div>
  </div> 

  <nav class="navbar navbar-expand-lg navbar-light sticky-header" style="background-color: whitesmoke; height: 80px;">
      <div class="container-fluid px-4 px-lg-5">
      <a class="nav-link active" aria-current="page" href="/">
          <h1 class="text-start">ÓPTICA <span class="burdeo">R</span><span class="gris">O</span><span class="burdeo">IS</span></h1>
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <% if(typeof isLoggedIn === 'undefined' || !isLoggedIn) { %>
          <ul class="navbar-nav ms-auto">
          <li class="nav-item">
              <button class="nav-link btn" onclick="location.href='/login'">
                  <i class="fas fa-user"></i>
              <span class="text" style="color: black;">Iniciar sesión</span>
              </button>
          </li>
          <li class="nav-item">
              <button class="nav-link btn" onclick="location.href='/register'">
                  <i class="fas fa-user-plus"></i>
              <span class="text" style="color: black;">Registrarse</span>
              </button>
          </li>
          <li id="ctn-icon-serch">
              <button class="nav-link btn" id="icon-search">
                  <i class="fas fa-search"></i>
              <span class="text" style="color: black;">Búsqueda</span>
              </button>
          </li>
          <li class="nav-item">
              <button class="nav-link btn" onclick="location.href='#bottom'">
                  <i class="fas fa-question-circle"></i> 
              <span class="text" style="color: black;">Nosotros</span>
              </button>
          </li>
          </ul>
          <% } else { %>
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
                <div class="dropdown">
                  <button class="nav-link btn" onclick="toggleDropdown()">
                    <i class="fas fa-user"></i>
                    <span class="text" style="color: black;">Mi cuenta</span>
                  </button>
                  <div id="dropdown-menu" class="dropdown-menu">
                    <div class="menu-item">
                      <i class="fas fa-user-edit"></i>
                      <a href="/profile">Editar perfil</a>
                    </div>
                    <div class="menu-item">
                      <i class="fas fa-receipt"></i>
                      <a href="/orders">Ver pedidos</a>
                    </div>
                  </div>
                </div>
              </li>
          <li class="nav-item">
              <button class="nav-link btn" onclick="location.href='#bottom'">
                  <i class="fas fa-question-circle"></i> 
              <span class="text" style="color: black;">Nosotros</span>
              </button>
          </li>
          <li class="nav-item" >
              <form action="/logout" method="post"> 
              <button class="nav-link btn">
                  <i class="fas fa-sign-out-alt"></i> 
              <span class="text" style="color: black;">Cerrar sesión</span>
              </button>
          </form>
          </li>
          </ul>
          <% } %>
      </div>
      </div>
  </nav>
      
        <header style="justify-content: center;"> 
          <div class="alert alert-info alert-dismissable" style="margin-top: 1%;">
            <a class="panel-close close" data-dismiss="alert">×</a> 
            <i class="fas fa-exclamation-triangle"></i>
            Verifica cuidadosamente los <strong>cambios</strong> antes de <strong>guardar</strong>, ya que esto puede afectar tu información.
          </div>
        </header>
                
        <div class="body-profile">
        <form class="cuerpo" action="edit_profile" method="post" enctype="multipart/form-data" role="form">
          <h2 style="margin-bottom: 1%;">Editar perfil</h2>

          <div class="container-input" style="margin-bottom: -4%;">
            <label for="first-name">Primer nombre:</label>
            <div class="input-container">
                <span><i class="fa fa-user-circle"></i></span>
                <input type="text" id="first-name" name="primer_nombre" value="<%= result[0].primer_nombre %>" required>
            </div>
        
            <label for="last-name">Segundo nombre:</label>
            <div class="input-container">
                <span><i class="fa fa-user-circle"></i></span>
                <input type="text" id="last-name" name="segundo_nombre" value="<%= result[0].segundo_nombre %>" required>
            </div>
        
            <label for="first-name">Primer apellido:</label>
            <div class="input-container">
                <span><i class="fa fa-user-circle"></i></span>
                <input type="text" id="first-name" name="primer_apellido" value="<%= result[0].primer_apellido %>" required>
            </div>
        
            <label for="last-name">Segundo apellido:</label>
            <div class="input-container">
                <span><i class="fa fa-user-circle"></i></span>
                <input type="text" id="last-name" name="segundo_apellido" value="<%= result[0].segundo_apellido %>" required>
            </div>
        
            <label for="field1">Email:</label>
            <div class="input-container">
                <span><i class="fa fa-envelope"></i></span>
                <input type="mail" id="field1" name="email" value="<%= result[0].email %>" required>
            </div>
        
            <label for="current-password">Contraseña actual:</label>
            <div class="input-container">
                <span><i class="fa fa-key"></i></span>
                <input type="password" id="current-password" name="current_password" required>
            </div>

            <label for="repeat-password">Repetir contraseña actual:</label>
            <div class="input-container">
                <span><i class="fa fa-key"></i></span>
                <input type="password" id="repeat-password" name="repeat_current_password" required>
            </div>
            <div id="password-error" style="color: red;"></div>

            <label for="new-password">Nueva contraseña:</label>
            <div class="input-container">
                <span><i class="fa fa-key"></i></span>
                <input type="password" id="new-password" name="new_password">
            </div>

            <label for="field3">Receta:</label>
            <div class="input-container" style="left: 10%;">
                <input style="color: black;" type="file" id="field3" name="file"><br><br>
            </div>
            
            <label for="recipe-image">Imagen de la receta:</label>
            <div class="image-container" style="width: 150px; height: 150px; margin-left: 16.5%;">
              <img id="recipe-image" src="<%=result[0].receta%>" alt="Imagen de la receta" style="width:140px;height:140px; cursor: pointer;">
          </div>
          
            <div id="popup" style="display: none; position: fixed; width: 100%; height: 100%; top: 0; left: 0; background: rgba(0,0,0,0.5);">
              <img id="popup-image" style="display: block; max-width: 80%; max-height: 80%; margin: auto; position: absolute; top: 0; left: 0; bottom: 0; right: 0;">
            </div>
          
        </div>
      
          <div class="container-botones" style="margin-top: -1%; margin-bottom: -5%;">
            <button class="btn login-boton" type="submit">Guardar Cambios</button> 
            <button class="btn login-boton" onclick="returnar()">Cancelar</button>
          </div>
        </form>
      </div>
        <!-- Footer-->
        <%- include("footer") %>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

        <script>
            function toggleDropdown() {
              var dropdownMenu = document.getElementById('dropdown-menu');
              dropdownMenu.classList.toggle('show');
            }
            
            var dropdownLinks = document.querySelectorAll('#dropdown-menu a');
            dropdownLinks.forEach(function(link) {
              link.addEventListener('click', function() {
                var dropdownMenu = document.getElementById('dropdown-menu');
                dropdownMenu.classList.remove('show');
              });
            });
            </script>


        <script>
        function returnar() {
        window.location.href = "/";
        }
        </script>

        <script>
            function redirectToProfile() {
            window.location.href = "/profile";
            }
        </script>

        <script>
          document.getElementById('recipe-image').addEventListener('click', function() {
          document.getElementById('popup-image').src = this.src;
          document.getElementById('popup').style.display = 'block';
          document.getElementById('popup').style.background = 'rgba(255,255,255,0.9)';  // Hace que el fondo del pop-up sea blanco
          document.body.style.overflow = 'hidden';  
          });
          document.getElementById('popup').addEventListener('click', function() {
              this.style.display = 'none';
              document.body.style.overflow = 'auto';  
          });
        </script>
        
        <script>
          $(document).ready(function() {
            $(".panel-close").click(function() {
            $(this).closest(".alert").fadeOut();
            });
          });
        </script>

        <script>
          $(document).ready(function() {
              $('#repeat-password').on('input', function() {
                  var current_password = $('#current-password').val();
                  var repeat_password = $(this).val();
                  if(current_password !== repeat_password) {
                      $('#password-error').text('Las contraseñas no coinciden.');
                  } else {
                      $('#password-error').text('');
                  }
              });
          });
          </script>

        <script src="js/script.js"></script>
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="js/scripts.js"></script>
    </body>
</html>